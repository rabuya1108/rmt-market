<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RMTãƒãƒ¼ã‚±ãƒƒãƒˆ</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      margin: 2em;
    }
    input, button {
      padding: 0.6em;
      margin: 0.5em 0;
      font-size: 1em;
      width: 100%;
      max-width: 400px;
    }
    .post-card {
      background: #222;
      padding: 1em;
      margin: 1em 0;
      border: 1px solid #444;
      border-radius: 8px;
    }
    .post-card button {
      margin-right: 0.5em;
      background-color: #555;
      border: none;
      color: #fff;
      cursor: pointer;
      padding: 0.4em 0.8em;
      border-radius: 4px;
    }
    .post-card button:hover {
      background-color: #777;
    }
  </style>
</head>
<body>
  <h1>RMTãƒãƒ¼ã‚±ãƒƒãƒˆ</h1>

  <input id="itemName" placeholder="å•†å“å" />
  <input id="itemPrice" placeholder="ä¾¡æ ¼" />
  <input id="sellerName" placeholder="ã‚ãªãŸã®åå‰" />
  <button id="postBtn">å‡ºå“</button>

  <div id="posts"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, remove, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC-vljhQcGPgd3g4VLLUN5xkIzD0NTVNV8",
      authDomain: "rmt-market.firebaseapp.com",
      projectId: "rmt-market",
      storageBucket: "rmt-market.firebasestorage.app",
      messagingSenderId: "573324963079",
      appId: "1:573324963079:web:ff9109e3bee9710ff529a2",
      measurementId: "G-219L8N300W",
      databaseURL: "https://rmt-market-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const itemInput = document.getElementById("itemName");
    const priceInput = document.getElementById("itemPrice");
    const sellerInput = document.getElementById("sellerName");
    const postBtn = document.getElementById("postBtn");
    const postsContainer = document.getElementById("posts");

    let editingKey = null;

    postBtn.addEventListener("click", () => {
      const item = itemInput.value;
      const price = priceInput.value;
      const seller = sellerInput.value;

      if (!item || !price || !seller) return alert("ã™ã¹ã¦å…¥åŠ›ã—ã¦ã­");

      const data = { item, price, seller };

      if (editingKey) {
        update(ref(db, 'posts/' + editingKey), data);
        editingKey = null;
        postBtn.textContent = "å‡ºå“";
      } else {
        push(ref(db, 'posts'), data);
      }

      itemInput.value = "";
      priceInput.value = "";
    });

    onChildAdded(ref(db, 'posts'), (snapshot) => {
      const post = snapshot.val();
      const key = snapshot.key;

      const card = document.createElement("div");
      card.className = "post-card";

      const name = document.createElement("p");
      name.innerHTML = `<strong>å•†å“å:</strong> ${post.item}`;
      const price = document.createElement("p");
      price.innerHTML = `<strong>ä¾¡æ ¼:</strong> ${post.price}`;
      const seller = document.createElement("p");
      seller.innerHTML = `<strong>å‡ºå“è€…:</strong> ${post.seller}`;

      const editBtn = document.createElement("button");
      editBtn.textContent = "âœï¸ ç·¨é›†";
      editBtn.style.display = "none";

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "ğŸ—‘ï¸ å‰Šé™¤";
      deleteBtn.style.display = "none";

      // å…¥åŠ›ã—ãŸå‡ºå“è€…åã¨ä¸€è‡´ã™ã‚Œã°è¡¨ç¤º
      if (post.seller === sellerInput.value) {
        editBtn.style.display = "inline-block";
        deleteBtn.style.display = "inline-block";
      }

      editBtn.onclick = () => {
        itemInput.value = post.item;
        priceInput.value = post.price;
        editingKey = key;
        postBtn.textContent = "ä¿å­˜";
      };

      deleteBtn.onclick = () => {
        if (confirm("æœ¬å½“ã«å‰Šé™¤ã™ã‚‹ï¼Ÿ")) {
          remove(ref(db, 'posts/' + key));
          card.remove();
        }
      };

      card.appendChild(name);
      card.appendChild(price);
      card.appendChild(seller);
      card.appendChild(editBtn);
      card.appendChild(deleteBtn);
      postsContainer.appendChild(card);
    });
  </script>
</body>
</html>